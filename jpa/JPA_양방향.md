# 개요
- 방향: 단방향, 양방향이 있다.방향은 객체 관계에만 존재하고 테이블 관계는 항상 양방향이다.
- 다중성: 다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M)
- 연관 관계의 주인: 객체를 양방향 연관 관계로 만들면 연관 관계의 주인을 정해야 한다.

# 양방향 연관관계

## 객체의 양방향 관계
- 객체의 양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단방향 관계 2개다

`@OneToMany`
- 일대다(1:N) 관계라는 매핑 정보
- mappedBy 속성은 연관 관계 주인의 필드 이름

`@ManyToMany`
- 다대일(N:1)관계라는 매핑 정보


## 테이블 양방향 연관관계
- 외래 키 하나로 두 테이블의 연관관계를 관리

# 연관관계의 주인(Owner)
- 양방향 매핑 규칙
- 객체의 두 관계 중 하나를 연관관계의 주인으로 지정
   -  연관관계의 주인만이 외래키를 관리
 - 주인 아닌쪽은 읽기만 가능
- 주인은 mappedBy 사용하지 않음
- 주인이 아니면 mappedBy 속성으로 주인지정

```
그래서 누구를 주인으로 ?
외래키가 있는 곳을 주인으로 정한다.
```

# 양방향 중 잘하는 실수
- 연관관계의 주인에 값을 입력하지 않음
- 연관관계의 주인에 의해서 등록 및 삭제가 이루어져야함
  -  주인이 아닌 역방향만 값을 주입하게 되면 실제 DB에는 값이 저장안됨

# 양방향 매핑
- 단방향 매핑만으로도 이미 연관관계 매핑은 완료
- 양방향 매핑은 반대방향으로 조회 기능이 추가된것 뿐
- JPQL에서 역방향으로 탐색할 일이 많음
- 단방향 매핑을 잘하고 양방향은 필요할 때 추가해도됨

# 다대다 연관관계
- 관계형 데이터베이스는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없다.
- 보통 다대다 관계를 일대다, 다대일 관계로 풀어내는 연결 테이블을 사용한다.
- 연결 테이블에 필드가 추가되면 더는 사용할 수 없다

```
@Entity
@Table(name = "line_station")
public class LineStation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "line_id")
    private Line line;
    
    @OneToOne
    @JoinColumn(name = "station_id")
    private Station station;
    
    ...

}
```

